<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>다마고치 위젯 생성기</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000000; font-family: 'Galmuri9', sans-serif; display: flex; justify-content: center; min-height: 100vh; padding: 20px; }
        .card { background: white; border-radius: 16px; width: 100%; max-width: 480px; padding: 32px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header-title { font-size: 1.5rem; font-weight: bold; text-align: center; color: #374151; margin-bottom: 20px; }
        .preview-container { background: linear-gradient(135deg, #ffffff, #ffffff   ); border-radius: 12px; padding: 20px; margin-bottom: 24px; text-align: center; border: 2px dashed #a70000; }
        .pixel-input { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; margin-top: 5px; font-family: 'Galmuri9'; }
        .section-title { font-weight: bold; color: #1f2937; display: block; margin-top: 15px; }
        .generate-btn { background: #202020; color: white; width: 100%; padding: 14px; border-radius: 8px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .generate-btn:hover { background: #000000; }
        .result-box { background: #ffffff; padding: 15px; border-radius: 8px; font-size: 0.8rem; word-break: break-all; margin-top: 10px; border: 2px solid #a70000; color: #343434; }
        iframe { border: none; width: 340px; height: 340px; transform: scale(0.85); transform-origin: top center; }
    </style>
</head>
<body>
    <div class="card">
        <h1 class="header-title">다마고치 위젯 생성기</h1>
        
        <div class="preview-container">
            <iframe id="previewFrame" src="widget.html"></iframe>
            <p style="font-size: 0.8rem; color: #646464; margin-top: -30px;">미리보기 화면입니다</p>
        </div>

        <div>
            <label class="section-title">응원 문구</label>
            <input type="text" id="inputTitle" class="pixel-input" value="안 하는 것보다 무조건 낫다!">
            
            <label class="section-title">목표 날짜</label>
            <input type="date" id="inputDate" class="pixel-input" value="2025-12-25">
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="section-title">타이머 1 (분)</label>
                    <input type="number" id="inputTimer1" class="pixel-input" value="15">
                </div>
                <div>
                    <label class="section-title">타이머 2 (분)</label>
                    <input type="number" id="inputTimer2" class="pixel-input" value="30">
                </div>
            </div>

            <button onclick="updateWidget()" class="generate-btn">설정 적용 & 주소 생성</button>
            
            <label class="section-title" style="margin-top: 20px;">이 주소를 노션에 임베드하세요</label>
            <div class="result-box" id="resultUrl">주소 생성 버튼을 눌러주세요</div>
            <button onclick="copyUrl()" class="generate-btn" style="background:#a70000; margin-top:10px;">주소 복사하기</button>
        </div>
    </div>

    <script>
        // 현재 이 파일이 있는 위치를 자동으로 찾습니다.
        // 예: https://my-site.vercel.app/
        const BASE_URL = window.location.href.substring(0, window.location.href.lastIndexOf("/") + 1);

        function generateParams() {
            const title = document.getElementById('inputTitle').value;
            const date = document.getElementById('inputDate').value;
            const t1 = document.getElementById('inputTimer1').value;
            const t2 = document.getElementById('inputTimer2').value;
            return `?title=${encodeURIComponent(title)}&date=${date}&timer=${t1}&timer2=${t2}`;
        }

        function updateWidget() {
            const params = generateParams();
            // 1. 미리보기 업데이트 (widget.html을 iframe 안에서 새로고침)
            document.getElementById('previewFrame').src = `widget.html${params}`;
            
            // 2. 최종 주소 생성 (내 도메인 + widget.html + 파라미터)
            const fullUrl = `${BASE_URL}widget.html${params}`;
            document.getElementById('resultUrl').innerText = fullUrl;
        }

        function copyUrl() {
            const text = document.getElementById('resultUrl').innerText;
            if(text.includes('주소 생성')) return alert('먼저 주소를 생성해주세요!');
            navigator.clipboard.writeText(text).then(() => alert('복사되었습니다! 노션에 붙여넣고 "임베드 생성"을 누르세요.'));
        }
        
        // 페이지 로드 시 한 번 실행
        updateWidget();
    </script>
</body>
</html>
