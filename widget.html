<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Retro Clock</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css">
    <style>
        /* 기본 설정 */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: transparent; /* 배경 투명 (노션 배경색과 어우러지게) */
            font-family: 'Galmuri9', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 위젯 전체를 감싸는 컨테이너 
           이 영역이 자바스크립트에 의해 scale 조정됩니다.
           기준 크기: 300px x 360px (비율 유지용)
        */
        #widget-container {
            width: 300px;
            height: 380px; 
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* transform-origin을 center로 두어 중앙에서 커지게 함 */
            transform-origin: center center; 
        }

        /* --- 1. LCD 화면 스타일 --- */
        .lcd-screen {
            width: 300px;
            height: 260px;
            background-color: #2f2f2f;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); /* 살짝 그림자 */
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            
            /* LCD 격자 무늬 */
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
            background-size: 3px 3px;
        }

        /* 스캔라인 효과 */
        .scanlines {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            z-index: 10;
            pointer-events: none;
            animation: scanline 10s linear infinite;
        }
        @keyframes scanline { from { background-position: 0 0; } to { background-position: 0 100%; } }

        /* 화면 내부 텍스트들 */
        .content-wrapper {
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .date-text {
            color: #ce1010;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: -0.5px;
        }

        .time-display {
            color: #e3e3e3;
            font-family: 'Galmuri11', sans-serif;
            font-size: 64px; /* 폰트 큼직하게 */
            font-weight: bold;
            line-height: 1;
            display: flex;
            align-items: baseline;
        }

        .ampm {
            font-size: 16px;
            color: #ce1010;
            margin-left: 8px;
            font-family: 'Galmuri9', sans-serif;
        }

        .quote-area {
            margin-top: 5px;
            color: #e3e3e3;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- 2. 버튼 영역 스타일 --- */
        .button-row {
            margin-top: 20px;
            display: flex;
            gap: 25px; /* 버튼 사이 간격 */
        }

        .square-btn {
            width: 45px;
            height: 40px;
            background-color: #ffffff;
            border: 2.5px solid #000000;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.1s;
        }

        .square-btn:hover {
            background-color: #f0f0f0;
        }
        .square-btn:active {
            transform: scale(0.95);
            background-color: #e0e0e0;
        }

        /* 기타 애니메이션 및 유틸 */
        .colon { animation: blink 1s steps(2, start) infinite; margin: 0 -2px; }
        .colon.paused { animation: none; opacity: 1; }
        @keyframes blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0; } }

        .pixel-heart { width: 12px; height: 12px; fill: #ce1010; animation: beat 1.5s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        /* 모달 (알림) */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 100; display: none;
            justify-content: center; align-items: center; border-radius: 12px;
        }
        .modal-box {
            background: #fff; padding: 20px; border-radius: 8px; text-align: center;
            border: 2px solid #ce1010;
        }
        
    </style>
</head>
<body>

    <div id="widget-container">
        
        <div class="lcd-screen">
            <div class="scanlines"></div>
            
            <div class="content-wrapper" id="screenContent">
                <div class="date-text" id="topText">2025.12.17 WED</div>
                
                <div class="time-display" id="displayContent">
                    <span id="hours">07</span><span class="colon">:</span><span id="minutes">07</span><span class="ampm">AM</span>
                </div>

                <div class="quote-area" id="iconArea">
                    <svg class="pixel-heart" viewBox="0 0 8 8"><path d="M2 2h2v1h-2z M5 2h2v1h-2z M1 3h7v1h-7z M2 4h5v1h-5z M3 5h3v1h-3z M4 6h1v1h-1z"/></svg>
                    <span id="bottomText">시작이 반이다</span>
                    <svg class="pixel-heart" viewBox="0 0 8 8"><path d="M2 2h2v1h-2z M5 2h2v1h-2z M1 3h7v1h-7z M2 4h5v1h-5z M3 5h3v1h-3z M4 6h1v1h-1z"/></svg>
                </div>
            </div>

            <div id="alertModal" class="modal-overlay">
                <div class="modal-box">
                    <p style="color:#ce1010; font-weight:bold; margin-bottom:10px;" id="alertMessage">TIME'S UP!</p>
                    <button onclick="closeModal()" style="background:#ce1010; color:#fff; border:none; padding:5px 10px; cursor:pointer;">확인</button>
                </div>
            </div>
        </div>

        <div class="button-row">
            <button class="square-btn" id="btnLeft" title="모드 변경"></button>
            <button class="square-btn" id="btnCenter" title="시작/정지"></button>
            <button class="square-btn" id="btnRight" title="타이머 설정"></button>
        </div>

    </div>

    <script>
        // --- [핵심] 자동 크기 조절 스크립트 ---
        // 창 크기가 변할 때마다 위젯을 확대/축소하여 꽉 채움
        const container = document.getElementById('widget-container');
        const BASE_WIDTH = 300;  // 위젯의 기본 가로 크기
        const BASE_HEIGHT = 380; // 위젯의 기본 세로 크기 (버튼 포함)

        function resizeWidget() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            // 가로와 세로 중 더 좁은 쪽을 기준으로 비율 계산 (여백 20px 정도 둠)
            const scaleX = (windowWidth - 20) / BASE_WIDTH;
            const scaleY = (windowHeight - 20) / BASE_HEIGHT;
            const scale = Math.min(scaleX, scaleY); // 비율 유지

            container.style.transform = `scale(${scale})`;
        }

        // 로드될 때와 창 크기 변경될 때 실행
        window.addEventListener('resize', resizeWidget);
        window.addEventListener('load', resizeWidget);


        // --- 기존 시계/타이머 로직 (동일함) ---
        const MODES = { CLOCK: 'clock', DDAY: 'dday', TIMER_1: 'timer_1', TIMER_2: 'timer_2' };
        let currentMode = MODES.CLOCK;
        let timerInterval = null;
        let timeLeft = 0;
        let totalTime = 0;
        let isPaused = true;
        let myQuote = "시작이 반이다";
        let dDayTargetDate = new Date('2025-12-25');
        let timer1Minutes = 15;
        let timer2Minutes = 30;

        const topTextEl = document.getElementById('topText');
        const displayContentEl = document.getElementById('displayContent');
        const bottomTextEl = document.getElementById('bottomText');
        const iconAreaEl = document.getElementById('iconArea');

        // URL 파라미터 처리
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('title')) myQuote = urlParams.get('title');
        if(urlParams.get('timer')) timer1Minutes = parseInt(urlParams.get('timer'));
        if(urlParams.get('timer2')) timer2Minutes = parseInt(urlParams.get('timer2'));

        function init() {
            updateDisplay();
            setInterval(() => {
                if (currentMode === MODES.CLOCK) updateClock();
            }, 1000);
            updateClock();
        }

        // 버튼 이벤트
        document.getElementById('btnLeft').onclick = () => {
            if (currentMode === MODES.TIMER_1 || currentMode === MODES.TIMER_2) {
                resetTimer(); currentMode = MODES.CLOCK;
            } else if (currentMode === MODES.CLOCK) {
                currentMode = MODES.DDAY;
            } else {
                currentMode = MODES.CLOCK;
            }
            updateDisplay();
        };

        document.getElementById('btnCenter').onclick = () => {
            if (currentMode.startsWith('timer')) toggleTimer();
            else startTimer(timer1Minutes, MODES.TIMER_1);
        };

        document.getElementById('btnRight').onclick = () => {
            if (currentMode.startsWith('timer')) toggleTimer();
            else startTimer(timer2Minutes, MODES.TIMER_2);
        };

        function startTimer(min, mode) {
            clearInterval(timerInterval);
            currentMode = mode;
            timeLeft = min * 60; totalTime = timeLeft;
            isPaused = false;
            updateDisplay();
            timerInterval = setInterval(tick, 1000);
        }

        function toggleTimer() {
            isPaused = !isPaused;
            updateDisplay();
        }

        function tick() {
            if(!isPaused && timeLeft > 0) {
                timeLeft--;
                updateTimerDisplay();
            } else if (!isPaused && timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById('alertModal').style.display = 'flex';
                isPaused = true;
            }
        }
        
        function resetTimer() { clearInterval(timerInterval); isPaused = true; }
        function closeModal() { 
            document.getElementById('alertModal').style.display = 'none'; 
            resetTimer(); currentMode = MODES.CLOCK; updateDisplay(); 
        }

        function updateDisplay() {
            // 하단 멘트 영역 복구
            if(currentMode === MODES.CLOCK) {
                updateClock();
                iconAreaEl.style.display = 'flex';
                bottomTextEl.innerText = myQuote;
            } else if (currentMode === MODES.DDAY) {
                topTextEl.innerText = "TARGET DAY";
                // D-day 계산 로직
                const today = new Date(); today.setHours(0,0,0,0);
                const target = new Date(dDayTargetDate); target.setHours(0,0,0,0);
                const diff = Math.ceil((target - today) / (1000*60*60*24));
                const dText = diff === 0 ? "D-DAY" : (diff > 0 ? `D-${diff}` : `D+${Math.abs(diff)}`);
                
                displayContentEl.innerHTML = `<span style="font-size:70px">${dText}</span>`;
                iconAreaEl.style.display = 'flex';
                bottomTextEl.innerText = `${target.getFullYear()}.${target.getMonth()+1}.${target.getDate()} 마감`;
            } else {
                updateTimerDisplay();
            }
        }

        function updateClock() {
            const now = new Date();
            const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
            topTextEl.innerText = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} ${days[now.getDay()]}`;
            
            let h = now.getHours();
            const m = String(now.getMinutes()).padStart(2,'0');
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            
            displayContentEl.innerHTML = `<span id="hours">${String(h).padStart(2,'0')}</span><span class="colon">:</span><span id="minutes">${m}</span><span class="ampm">${ampm}</span>`;
        }

        function updateTimerDisplay() {
            const min = Math.floor(timeLeft / 60);
            const sec = timeLeft % 60;
            const h = Math.floor(min / 60); // 1시간 이상일 경우

            topTextEl.innerText = isPaused ? "PAUSED" : "FOCUS TIME";
            
            if (h > 0) {
                 displayContentEl.innerHTML = `<span>${h}H ${String(min%60).padStart(2,'0')}M</span>`;
            } else {
                const colonClass = isPaused ? "colon paused" : "colon";
                displayContentEl.innerHTML = `<span id="hours">${String(min).padStart(2,'0')}</span><span class="${colonClass}">:</span><span id="minutes">${String(sec).padStart(2,'0')}</span>`;
            }
            
            // 타이머일때 하단 아이콘 트랙 표시 (간소화)
            iconAreaEl.style.display = 'flex';
            bottomTextEl.innerText = `${Math.floor(((totalTime-timeLeft)/totalTime)*100)}% 완료`;
        }

        init();
    </script>
</body>
</html>
