<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y2K LCD Clock & Pomodoro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 전체 리셋 및 화면 설정 */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #2f2f2f; /* LCD 배경색 */
            font-family: 'Galmuri9', sans-serif;
            user-select: none;
        }

        /* LCD 격자 무늬 배경 (전체 화면 적용) */
        body {
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            background-size: 3px 3px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* 1. 스캔라인 효과 (화면 전체 덮기) */
        .scanlines {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.1) 50%,
                rgba(0,0,0,0.1)
            );
            background-size: 100% 4px;
            z-index: 50;
            pointer-events: none;
            animation: scanline-scroll 20s linear infinite; 
        }
        @keyframes scanline-scroll {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        /* 화면 내용 래퍼 */
        .screen-content {
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px; /* 요소 간 간격 */
            width: 100%;
            height: 100%;
            transform-origin: center;
        }

        /* 2. TV 켜기/끄기 애니메이션 */
        .tv-out {
            animation: turn-off 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }
        .tv-in {
            animation: turn-on 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes turn-off {
            0% { transform: scale(1, 1); filter: brightness(1); opacity: 1; }
            50% { transform: scale(1, 0.02); filter: brightness(1.5); opacity: 1; }
            100% { transform: scale(0, 0); filter: brightness(0); opacity: 0; }
        }
        @keyframes turn-on {
            0% { transform: scale(0, 0); filter: brightness(0); opacity: 0; }
            50% { transform: scale(1, 0.02); filter: brightness(1.5); opacity: 1; }
            100% { transform: scale(1, 1); filter: brightness(1); opacity: 1; }
        }

        /* 폰트 및 텍스트 스타일 */
        .top-text {
            font-size: 0.85rem; 
            font-weight: bold;
            color: #ce1010;
            letter-spacing: -0.4px;
            text-transform: uppercase;
            text-align: center;
            display: flex; align-items: center; justify-content: center; gap: 4px;
        }

        .main-display {
            font-family: 'Galmuri11', sans-serif;
            font-weight: bold;
            font-size: 3.5rem; /* 화면이 커졌으므로 폰트 키움 */
            line-height: 1;
            color: #e3e3e3;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            display: flex;
            align-items: baseline;
            justify-content: center;
            text-align: center;
        }

        .ampm {
            font-family: 'Galmuri9', sans-serif;
            font-size: 1rem;
            color: #ce1010;
            margin-left: 8px;
        }

        /* 롤링 효과 */
        .rolling-digit {
            display: inline-block;
            animation: roll-down 1.0s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes roll-down {
            0% { transform: translateY(-50%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* 하단 아이콘 영역 */
        .icon-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            color: #ce1010;
            height: 30px;
        }
        .bottom-text {
            font-size: 0.7rem; 
            color: #e3e3e3;
            font-weight: bold;
            letter-spacing: -0.4px;
        }

        /* 버튼 그룹 (화면 하단에 오버레이) */
        .button-group-overlay {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
            opacity: 0.3; /* 평소엔 투명하게 */
            transition: opacity 0.3s;
        }
        .button-group-overlay:hover {
            opacity: 1; /* 마우스 올리면 선명하게 */
        }

        .control-btn {
            background: transparent;
            border: 1.5px solid #555;
            color: #777;
            font-family: 'Galmuri9', sans-serif;
            font-size: 0.7rem;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .control-btn:hover {
            border-color: #ce1010;
            color: #ce1010;
            background: rgba(0,0,0,0.2);
        }

        /* 알림 모달 */
        .modal-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(206, 16, 16, 0.3);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-box {
            background: #f3e0f0;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 3px solid #ce1010;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.2);
            animation: modal-pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes modal-pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .modal-btn {
            background: #ce1010;
            color: #fff;
            border: none;
            padding: 8px 24px;
            cursor: pointer;
            font-family: 'Galmuri9', sans-serif;
            font-weight: bold;
            border-radius: 4px;
            margin-top: 10px;
        }

        /* SVG & Track */
        .pixel-svg { width: 20px; height: 20px; fill: #ce1010; shape-rendering: crispEdges; }
        .mini-icon { width: 14px; height: 14px; fill: #ce1010; vertical-align: middle; }
        .box-icon { width: 12px; height: 12px; fill: #222; }
        
        .heart-beat { animation: beat 2.5s infinite steps(2); }
        @keyframes beat { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        
        @keyframes blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0; } }
        .colon { animation: blink 1s steps(2, start) infinite; margin: 0 -5px; } 
        .colon.paused { animation: none; opacity: 1; }

        .track-container { width: 150px; position: relative; height: 20px; display: flex; align-items: center; }
        .track-line { width: 100%; border-bottom: 2px dotted #ce1010; position: absolute; top: 50%; transform: translateY(-50%); z-index: 1; }
        .runner-heart { position: absolute; top: 50%; transform: translate(-50%, -50%); z-index: 2; transition: left 1s linear; }
        .runner-heart svg { width: 16px; height: 16px; fill: #ce1010; }

        .dday-info-box {
            background-color: #3d3d3d; color: #f3f4f6; padding: 4px 10px;
            border-radius: 4px; font-size: 0.6rem; display: flex; align-items: center; gap: 6px;
        }
    </style>
</head>
<body>

    <div class="scanlines"></div>

    <div id="screenContent" class="screen-content">
        <div class="top-text" id="topText">LOADING...</div>
        <div class="main-display">
            <span id="displayContent"><span id="hours">00</span><span class="colon">:</span><span id="minutes">00</span><span class="ampm">AM</span></span>
        </div>
        <div class="icon-area" id="iconArea">
            </div>
    </div>

    <div class="button-group-overlay">
        <button class="control-btn" id="btnLeft">HOME / MODE</button>
        <button class="control-btn" id="btnCenter">START / STOP</button>
        <button class="control-btn" id="btnRight">TIMER SET</button>
    </div>

    <div id="alertModal" class="modal-overlay">
        <div class="modal-box">
            <p class="modal-title" style="font-weight:bold; color:#ce1010; margin-bottom:10px;" id="alertMessage">TIME'S UP!</p>
            <button onclick="document.getElementById('alertModal').style.display='none'; document.getElementById('btnLeft').click();" class="modal-btn">확인</button>
        </div>
    </div>

    <script>
        // --- 기존 로직 유지 ---
        const MODES = { CLOCK: 'clock', DDAY_BIG: 'dday_big', TIMER_1: 'timer_1', TIMER_2: 'timer_2' };
        let currentMode = MODES.CLOCK;
        let timerInterval = null;
        let timeLeft = 0;
        let totalTime = 0; 
        let isPaused = true;
        let lastMinute = -1; 
        let typewriterTimeout = null; 

        // 설정값
        let dDayTargetDate = new Date('2025-12-25'); 
        let myQuote = "시작이 반이다";
        let timer1Minutes = 15;
        let timer2Minutes = 30;

        // DOM 요소
        const screenContentEl = document.getElementById('screenContent');
        const topTextEl = document.getElementById('topText');
        const displayContentEl = document.getElementById('displayContent');
        const iconAreaEl = document.getElementById('iconArea');
        const alertModal = document.getElementById('alertModal');
        const alertMessage = document.getElementById('alertMessage');

        // SVG 데이터
        const svgs = {
            heart: `<svg class="pixel-svg heart-beat" viewBox="0 0 8 8"><path d="M2 2h2v1h-2z M5 2h2v1h-2z M1 3h7v1h-7z M2 4h5v1h-5z M3 5h3v1h-3z M4 6h1v1h-1z" /></svg>`,
            heartRunner: `<svg viewBox="0 0 8 8"><path d="M2 2h2v1h-2z M5 2h2v1h-2z M1 3h7v1h-7z M2 4h5v1h-5z M3 5h3v1h-3z M4 6h1v1h-1z" /></svg>`,
            miniClock: `<svg class="mini-icon" viewBox="0 0 16 16"><path d="M8 2a6 6 0 1 0 0 12A6 6 0 0 0 8 2zm0 11a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/><path d="M8.5 4.5a.5.5 0 0 0-1 0v3.293L6.354 8.94a.5.5 0 1 0 .708.708l1.5-1.5A.5.5 0 0 0 8.5 8V4.5z"/></svg>`,
            calendar: `<svg class="box-icon" viewBox="0 0 16 16"><path d="M1 4h14v10H1z M2 5h12v8H2z M3 2h2v1H3z M11 2h2v1h-2z M1 3h1v1H1z M14 3h1v1h-1z M3 6h2v2H3z M6 6h2v2H6z M9 6h2v2H9z M12 6h2v2h-2z M3 9h2v2H3z M6 9h2v2H6z M9 9h2v2H9z" /></svg>`
        };

        function parseURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const titleParam = urlParams.get('title');
            if (titleParam) myQuote = titleParam;
            const dateParam = urlParams.get('date');
            if (dateParam) {
                const formattedDate = dateParam.replace(/\./g, '-');
                const parsedDate = new Date(formattedDate);
                if (!isNaN(parsedDate.getTime())) dDayTargetDate = parsedDate;
            }
            const t1 = urlParams.get('timer');
            if (t1) timer1Minutes = parseTimeInput(t1);
            const t2 = urlParams.get('timer2');
            if (t2) timer2Minutes = parseTimeInput(t2);
        }

        function parseTimeInput(input) {
            if (!input) return 15;
            if (input.includes(':')) {
                const parts = input.split(':');
                return (parseInt(parts[0], 10) || 0) * 60 + (parseInt(parts[1], 10) || 0);
            }
            return parseInt(input, 10) || 15;
        }

        function formatMinutesToHM(totalMinutes) {
            const h = Math.floor(totalMinutes / 60);
            const m = totalMinutes % 60;
            return (h > 0 && m > 0) ? `${h}H ${m}M` : (h > 0 ? `${h}H` : `${m}M`);
        }

        function formatSecondsToDisplay(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            if (h > 0) return { text: `${h}H<span style="margin:0 5px;"></span>${String(m).padStart(2,'0')}M`, hasHours: true };
            return { text: `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`, hasHours: false };
        }

        function init() {
            parseURLParams();
            updateDisplay();
            setInterval(() => {
                if (currentMode === MODES.CLOCK) updateClock();
            }, 1000);
            updateClock();
        }

        function getDDayString() {
            if (!dDayTargetDate) return "NO DATE";
            const today = new Date(); today.setHours(0,0,0,0);
            const target = new Date(dDayTargetDate); target.setHours(0,0,0,0);
            const diffDays = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
            if (diffDays === 0) return "D-DAY";
            return diffDays > 0 ? `D-${diffDays}` : `D+${Math.abs(diffDays)}`;
        }

        function switchModeWithTVAnimation(nextModeAction) {
            screenContentEl.classList.remove('tv-in');
            screenContentEl.classList.add('tv-out');
            setTimeout(() => {
                nextModeAction();
                screenContentEl.classList.remove('tv-out');
                screenContentEl.classList.add('tv-in');
            }, 500); 
        }

        function typeWriter(text, element) {
            if (typewriterTimeout) clearTimeout(typewriterTimeout);
            element.innerHTML = '';
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    typewriterTimeout = setTimeout(type, 200); 
                }
            }
            type();
        }

        // --- 버튼 이벤트 리스너 ---
        document.getElementById('btnLeft').addEventListener('click', () => {
            switchModeWithTVAnimation(() => {
                if (currentMode === MODES.TIMER_1 || currentMode === MODES.TIMER_2) {
                    resetTimer();
                    currentMode = MODES.CLOCK;
                } else if (currentMode === MODES.CLOCK) {
                    currentMode = MODES.DDAY_BIG;
                } else if (currentMode === MODES.DDAY_BIG) {
                    currentMode = MODES.CLOCK;
                }
                updateDisplay(true); 
            });
        });

        document.getElementById('btnCenter').addEventListener('click', () => {
            if (currentMode === MODES.TIMER_1 || currentMode === MODES.TIMER_2) {
                toggleTimer(); 
            } else {
                // 시계 모드에서 센터 버튼 누르면 타이머 1 시작
                switchModeWithTVAnimation(() => {
                    startTimer(timer1Minutes, MODES.TIMER_1);
                });
            }
        });

        document.getElementById('btnRight').addEventListener('click', () => {
            if (currentMode === MODES.TIMER_1 || currentMode === MODES.TIMER_2) {
                // 타이머 모드에서 오른쪽 버튼은 정지/리셋 등의 기능으로 쓸 수도 있으나
                // 여기선 타이머 간 전환으로 유지하거나, 현재 동작중이면 토글
                toggleTimer();
            } else {
                switchModeWithTVAnimation(() => {
                    startTimer(timer2Minutes, MODES.TIMER_2);
                });
            }
        });

        function startTimer(minutes, mode) {
            clearInterval(timerInterval);
            timerInterval = null;
            currentMode = mode;
            timeLeft = minutes * 60;
            totalTime = timeLeft;
            isPaused = false;
            updateDisplay(true); 
            timerInterval = setInterval(tick, 1000);
        }

        function toggleTimer() {
            isPaused = !isPaused;
            updateDisplay(false); 
        }

        function tick() {
            if (!isPaused && (currentMode === MODES.TIMER_1 || currentMode === MODES.TIMER_2)) {
                if (timeLeft > 0) {
                    timeLeft--;
                    const displayFormat = formatSecondsToDisplay(timeLeft);
                    if (displayFormat.hasHours) {
                        displayContentEl.innerHTML = `<span>${displayFormat.text}</span>`;
                    } else {
                        const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                        const s = (timeLeft % 60).toString().padStart(2, '0');
                        const colonClass = isPaused ? "colon paused" : "colon";
                        displayContentEl.innerHTML = `<span id="hours">${m}</span><span class="${colonClass}">:</span><span id="minutes">${s}</span>`;
                    }
                    updateRunnerPosition();
                } else {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    isPaused = true;
                    showAlert("TIME'S UP!");
                    updateDisplay(false);
                }
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            isPaused = true;
        }

        function updateDisplay(playTypewriter = false) {
            iconAreaEl.innerHTML = '';
            
            if (currentMode === MODES.CLOCK) {
                updateClock();
                iconAreaEl.innerHTML = `${svgs.heart}<div class="bottom-text" id="bottomText"></div>${svgs.heart}`;
                if(playTypewriter) typeWriter(myQuote, document.getElementById('bottomText'));
                else document.getElementById('bottomText').innerHTML = myQuote;

            } else if (currentMode === MODES.DDAY_BIG) {
                topTextEl.textContent = "TARGET DAY";
                displayContentEl.innerHTML = getDDayString();
                const y = dDayTargetDate.getFullYear();
                const m = String(dDayTargetDate.getMonth() + 1).padStart(2, '0');
                const d = String(dDayTargetDate.getDate()).padStart(2, '0');
                iconAreaEl.innerHTML = `<div class="dday-info-box">${svgs.calendar}<span><b>${y}.${m}.${d}</b> 마감</span></div>`;

            } else if (currentMode === MODES.TIMER_1 || currentMode === MODES.TIMER_2) {
                updateTimerDisplay();
                iconAreaEl.innerHTML = `<div class="track-container"><div class="track-line"></div><div class="runner-heart" id="runnerHeart">${svgs.heartRunner}</div></div>`;
                updateRunnerPosition();
            }
        }

        function updateRunnerPosition() {
            const runner = document.getElementById('runnerHeart');
            if (runner && totalTime > 0) {
                const progress = ((totalTime - timeLeft) / totalTime) * 100;
                runner.style.left = `${progress}%`;
            }
        }

        function updateTimerDisplay() {
            const currentMins = currentMode === MODES.TIMER_1 ? timer1Minutes : timer2Minutes;
            const timerText = `${formatMinutesToHM(currentMins)} FOCUS`;
            
            if (isPaused) topTextEl.innerHTML = "PAUSED";
            else topTextEl.innerHTML = `${svgs.miniClock} ${timerText} ${svgs.miniClock}`;

            const displayFormat = formatSecondsToDisplay(timeLeft);
            if (displayFormat.hasHours) {
                displayContentEl.innerHTML = `<span>${displayFormat.text}</span>`;
            } else {
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                const colonClass = isPaused ? "colon paused" : "colon";
                displayContentEl.innerHTML = `<span id="hours">${m}</span><span class="${colonClass}">:</span><span id="minutes">${s}</span>`;
            }
        }

        function updateClock() {
            if (currentMode !== MODES.CLOCK) return;
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            topTextEl.textContent = `${year}.${month}.${day} ${dayNames[now.getDay()]}`;

            let hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12; hours = hours ? hours : 12;
            hours = String(hours).padStart(2, '0');

            let minHtml = minutes;
            if (lastMinute !== minutes && lastMinute !== -1) minHtml = `<span class="rolling-digit">${minutes}</span>`;
            lastMinute = minutes;

            displayContentEl.innerHTML = `<span id="hours">${hours}</span><span class="colon">:</span><span id="minutes">${minHtml}</span><span class="ampm">${ampm}</span>`;
        }

        function showAlert(msg) {
            alertMessage.textContent = msg;
            alertModal.style.display = 'flex';
        }

        init();
    </script>
</body>
</html>
